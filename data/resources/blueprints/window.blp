using Gtk 4.0;
using Adw 1;

template $AppWindow : Adw.ApplicationWindow {
  default-width: 400;
  default-height: 600;
  width-request: 300;
  height-request: 300;
  title: _("Impression");

  Box {
    orientation: vertical;

    Adw.HeaderBar headerbar {
      Button refresh_button {
        icon-name: "view-refresh-symbolic";
        tooltip-text: _("Refresh Devices");
        visible: false;

        styles [
          "flat",
        ]
      }

      [end]
      MenuButton {
        icon-name: "open-menu-symbolic";
        menu-model: primary_menu;
        tooltip-text: _("Main Menu");
        primary: true;
      }
    }

    Stack stack {
      transition-type: crossfade;

      StackPage {
        name: "welcome";
        child: 
        Adw.StatusPage {
          icon-name: "io.gitlab.adhami3310.Impression-symbolic";
          title: _("Flash Images");
          description: _("Open a disk image to flash to a USB drive.");
          hexpand: true;
          vexpand: true;
          child: 
          Box {
            orientation: vertical;
            spacing: 12;

            Button open_image_button {
              valign: center;
              halign: center;
              label: _("Open File…");
              use-underline: true;

              styles [
                "suggested-action",
                "pill",
              ]
            }
          }

          ;
        }

        ;
      }

      StackPage {
        name: "device_list";
        child: 
        Adw.PreferencesPage {
          valign: center;

          Adw.PreferencesGroup {
            Box {
              orientation: vertical;
              spacing: 12;

              Image {
                icon-name: "application-x-generic";
                pixel-size: 64;

                styles [
                  "icon-dropshadow",
                ]
              }

              Label name_value_label {
                label: "arch.iso";
                wrap: true;
                wrap-mode: word_char;
                lines: 3;
                justify: center;
                max-width-chars: 24;

                styles [
                  "title-3",
                ]
              }

              Label size_label {
                justify: center;

                styles [
                  "caption",
                ]
              }
            }
          }

          Adw.PreferencesGroup {
            ListBox available_devices_list {
              selection-mode: none;

              styles [
                "boxed-list",
              ]
            }
          }

          Adw.PreferencesGroup {
            valign: end;
            halign: center;
            description: _("Warning: This will erase all data on the selected drive.");

            Button flash_button {
              label: _("Flash!");
              halign: center;

              styles [
                "destructive-action",
                "pill",
              ]
            }
          }
        }

        ;
      }

      StackPage {
        name: "loading";
        child: 
        Adw.StatusPage {
          Box {
            orientation: vertical;
            spacing: 12;

            Spinner loading_spinner {
              valign: center;
              halign: center;
              height-request: 28;
              width-request: 28;
            }

            Label {
              label: _("Updating device list…");

              styles [
                "title-3",
              ]
            }
          }
        }

        ;
      }

      StackPage {
        name: "no_devices";
        child: 
        Adw.StatusPage {
          icon-name: "usb-stick-symbolic";
          title: _("No Drives");
          description: _("Insert a USB drive to flash the image onto.");
        }

        ;
      }

      StackPage {
        name: "success";
        child: 
        Adw.StatusPage {
          icon-name: "check-round-outline-symbolic";
          title: _("Image Flashed");
          description: _("Have a nice day!");
          child: 
          Box {
            orientation: vertical;
            spacing: 12;

            Button done_button {
              valign: center;
              halign: center;
              label: _("Done");
              use-underline: true;

              styles [
                "suggested-action",
                "pill",
              ]
            }
          }

          ;
        }

        ;
      }

      StackPage {
        name: "failure";
        child: 
        Adw.StatusPage {
          icon-name: "error-symbolic";
          title: _("Flashing Image Unsuccessful");
          child: 
          Box {
            orientation: vertical;
            spacing: 12;

            Button try_again_button {
              valign: center;
              halign: center;
              label: _("Flash Again");
              use-underline: true;

              styles [
                "suggested-action",
                "pill",
              ]
            }
          }

          ;
        }

        ;
      }

      StackPage {
        name: "flashing";
        child:
        $AdwStatusPage flashing_page {
          title: _("Flashing…");

          Box {
            orientation: vertical;
            spacing: 36;

            ProgressBar progress_bar {
              valign: center;
              halign: center;
              show-text: true;
            }

            Button cancel_button {
              valign: center;
              halign: center;
              label: _("_Cancel");
              use-underline: true;

              styles [
                "destructive-action",
                "pill",
              ]
            }
          }
        }

        ;
      }
    }
  }
}

menu primary_menu {
  section {
    item {
      label: _("Open File");
      action: "win.open";
    }

    item {
      label: _("New Window");
      action: "app.new-window";
    }
  }

  section {
    item {
      label: _("Keyboard Shortcuts");
      action: "win.show-help-overlay";
    }

    item {
      label: _("About Impression");
      action: "win.about";
    }
  }
}
